<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mathematics for Machine Learning - 7&nbsp; Multivariate Calculus</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notebooks/probability.html" rel="next">
<link href="../notebooks/matrix-algebra.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multivariate Calculus</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Mathematics for Machine Learning</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/basic-math.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Basic Math</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/numerical-computing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Numerical Computation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/calculus.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Calculus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/linear-systems.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Linear Systems</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/vector-spaces.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Vector Spaces</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/matrix-algebra.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matrix Algebra</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/multivariate-calculus.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multivariate Calculus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/probability.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Basic Probability</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#differential-calculus-in-2d" id="toc-differential-calculus-in-2d" class="nav-link active" data-scroll-target="#differential-calculus-in-2d"><span class="toc-section-number">7.1</span>  Differential Calculus in 2D</a>
  <ul class="collapse">
  <li><a href="#partial-differentials" id="toc-partial-differentials" class="nav-link" data-scroll-target="#partial-differentials"><span class="toc-section-number">7.1.1</span>  Partial Differentials</a></li>
  <li><a href="#total-differentials" id="toc-total-differentials" class="nav-link" data-scroll-target="#total-differentials"><span class="toc-section-number">7.1.2</span>  Total Differentials</a></li>
  <li><a href="#tangent-planes" id="toc-tangent-planes" class="nav-link" data-scroll-target="#tangent-planes"><span class="toc-section-number">7.1.3</span>  Tangent Planes</a></li>
  <li><a href="#gradients" id="toc-gradients" class="nav-link" data-scroll-target="#gradients"><span class="toc-section-number">7.1.4</span>  Gradients</a></li>
  <li><a href="#hessians" id="toc-hessians" class="nav-link" data-scroll-target="#hessians"><span class="toc-section-number">7.1.5</span>  Hessians</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multivariate Calculus</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this lesson I’ll finally go back to calculus after a long detour into linear algebra. I’ll talk about the calculus of multivariate functions. While it may seem odd to do so much linear algebra in between the calculus lessons, there’s a good reason for it. In some sense multivariate calculus is a marriage of both ordinary univariate calculus and linear algebra. Let’s get started.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sympy <span class="im">as</span> sp</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils.math_ml <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="differential-calculus-in-2d" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="differential-calculus-in-2d"><span class="header-section-number">7.1</span> Differential Calculus in 2D</h2>
<p>In univariate calculus we were interested in functions of the form <span class="math inline">\(y=f(x)\)</span>, where <span class="math inline">\(y\)</span> is a single output that depends continuously on a single input <span class="math inline">\(x\)</span>. We can extend differentiation to higher dimensions as well. To keep things simple, let’s start with <em>bivariate</em> functions of the form <span class="math inline">\(z = f(x,y)\)</span>. The output <span class="math inline">\(z\)</span> will now depend continuously on <em>two</em> input variables <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>.</p>
<p>Recall the graph of a bivariate function is a two-dimensional surface. For example, here’s a plot of the function</p>
<p><span class="math display">\[z = x^2 + y^2.\]</span></p>
<p>The graph of this function is an upward-facing bowl centered at the origin <span class="math inline">\((0,0,0)\)</span>.</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, y: x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plot_function_3d(x, y, f, title<span class="op">=</span><span class="st">'$z=x^2+y^2$'</span>, titlepad<span class="op">=</span><span class="dv">10</span>, labelpad<span class="op">=</span><span class="dv">5</span>, ticks_every<span class="op">=</span>[<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">50</span>], dist<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                 figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multivariate-calculus_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="partial-differentials" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="partial-differentials"><span class="header-section-number">7.1.1</span> Partial Differentials</h3>
<p>Suppose we have some bivariate function <span class="math inline">\(z=f(x,y)\)</span>. We ultimately want to figure out how does a small change in both inputs create small changes in the output. It’s simpler to start with the case where we only change one input at a time, while imagining the other one is constant.</p>
<p>Let’s start by pretending <span class="math inline">\(y\)</span> is constant and only <span class="math inline">\(x\)</span> is allowed to vary. Then for all practical purposes <span class="math inline">\(z\)</span> is a function of <span class="math inline">\(x\)</span> alone. To make this easier to visualize I’ll write <span class="math inline">\(z = f(x, \begingroup\color{red}y\endgroup)\)</span> to represent this idea. Variables in black will be allowed to vary, and variables in red are assumed to be held constant.</p>
<p>Let me also go ahead and introduce the notion of a <strong>partial differential</strong>. In situations where we’re only varying one input variable while holding the rest fixed, it’s common to use a special notation for the differentials. Instead of writing <span class="math inline">\(dz\)</span> for the differential of <span class="math inline">\(z\)</span>, we’d write <span class="math inline">\(\partial z\)</span> (pronounced “partial z”) to make it clear we’re only varying one input. If the input we’re varying is <span class="math inline">\(x\)</span>, we might write <span class="math inline">\(\partial_x z\)</span> to make this extra clear. If we’re varying <span class="math inline">\(y\)</span>, we’d write <span class="math inline">\(\partial_y z\)</span>. Since the input differentials <span class="math inline">\(dx\)</span> and <span class="math inline">\(dy\)</span> don’t depend on anything we can denote them either way. That is, <span class="math inline">\(\partial x = dx\)</span> and <span class="math inline">\(\partial y = dy\)</span>.</p>
<p>Now, suppose we change <span class="math inline">\(x\)</span> by some infinitesimal amount <span class="math inline">\(\partial x\)</span>. Then <span class="math inline">\(z\)</span> will change by an amount</p>
<p><span class="math display">\[\partial_x z = f(x + \partial x, \begingroup\color{red}y\endgroup) - f(x, \begingroup\color{red}y\endgroup).\]</span></p>
<p>Remember, <span class="math inline">\(z=f(x, \color{red}{y})\)</span> is a univariate function of <span class="math inline">\(x\)</span> alone. As long as you’ve got that clear in your mind, it’s okay to write the function as <span class="math inline">\(z=f(x, y)\)</span> and mentally remember <span class="math inline">\(y\)</span> is fixed. Dividing both sides by <span class="math inline">\(\partial x\)</span> gives some kind of derivative, which we call the <strong>partial derivative</strong> with respect to <span class="math inline">\(x\)</span>,</p>
<p><span class="math display">\[\frac{\partial z}{\partial x} = \frac{f(x+\partial x, \color{red}{y}) - f(x, \color{red}{y})}{\partial x}.\]</span></p>
<p>When writing the partial derivative, we tend to lazily write <span class="math inline">\(\partial z\)</span> instead of <span class="math inline">\(\partial_x z\)</span> since the denominator makes it clear what we’re varying. Just as with the ordinary derivative, the partial derivative says how much the output will vary in response to small changes in the input, except with the caveat that we’re only varying <span class="math inline">\(x\)</span> and keeping <span class="math inline">\(y\)</span> fixed.</p>
<p>We can of course do exactly the same thing with the variables reversed, varying <span class="math inline">\(y\)</span> and fixing <span class="math inline">\(x\)</span>. In that case, we’d have <span class="math inline">\(z = f(\begingroup\color{red}x\endgroup, y)\)</span>. If we change <span class="math inline">\(y\)</span> by an infinitesimal amount <span class="math inline">\(\partial y\)</span>, then <span class="math inline">\(z\)</span> changes by an amount</p>
<p><span class="math display">\[\partial_y z = f(\begingroup\color{red}x\endgroup, y + \partial y) - f(\begingroup\color{red}x\endgroup, y).\]</span></p>
<p>Dividing everything by <span class="math inline">\(\partial y\)</span> gives the partial derivative with respect to <span class="math inline">\(y\)</span>,</p>
<p><span class="math display">\[\frac{\partial z}{\partial y} = \frac{f(\begingroup\color{red}x\endgroup, y + \partial y) - f(\begingroup\color{red}x\endgroup, y)}{\partial y}.\]</span></p>
<p>The partial derivative with respect to <span class="math inline">\(y\)</span> says how much <span class="math inline">\(z\)</span> will change in response to small changes in <span class="math inline">\(y\)</span> alone, at a given fixed value of <span class="math inline">\(x\)</span>.</p>
<p>It’s a good idea to go ahead and do a couple of examples. Despite all the weird notation floating around, calculating partial derivatives symbolically isn’t hard. All you do is differentiate the function with respect to the given variable while pretending the other one is a constant. Since it’s just univariate differentiation, all the differentiation rules we learned before carry over as is.</p>
<p>As a simple example, take the function I plotted above, <span class="math inline">\(z = x^2 + y^2\)</span>. In that case, if we treat <span class="math inline">\(y\)</span> as constant and vary <span class="math inline">\(x\)</span>, then the partial differential of <span class="math inline">\(z\)</span> is</p>
<p><span class="math display">\[\partial_x z = f(x + \partial x, \begingroup\color{red}y\endgroup) - f(x, \begingroup\color{red}y\endgroup) = \big((x + \partial x)^2 + \begingroup\color{red}{y^2}\endgroup \big) - \big(x^2 + \begingroup\color{red}{y^2}\endgroup\big) \approx 2x \partial x,\]</span></p>
<p>Dividing both sides by <span class="math inline">\(\partial x\)</span> we get the partial derivative with respect to <span class="math inline">\(x\)</span>,</p>
<p><span class="math display">\[\frac{\partial z}{\partial x} = 2x.\]</span></p>
<p>Similarly, if we vary <span class="math inline">\(y\)</span> and hold <span class="math inline">\(x\)</span> fixed, the partial differential of <span class="math inline">\(z\)</span> is</p>
<p><span class="math display">\[\partial_y z = f(\begingroup\color{red}x\endgroup, y + \partial y) - f(\begingroup\color{red}x\endgroup, y) = \big(\begingroup\color{red}{x^2}\endgroup + (y + \partial y)^2 \big) - \big(\begingroup\color{red}{x^2}\endgroup + y^2\big) \approx 2y \partial y.\]</span></p>
<p>Dividing both sides by <span class="math inline">\(\partial y\)</span>, we get the partial derivative with respect to <span class="math inline">\(y\)</span>,</p>
<p><span class="math display">\[\frac{\partial z}{\partial y} = 2y.\]</span></p>
<p>To take a more complicated example, suppose we had the function</p>
<p><span class="math display">\[z = e^x \sin 5y - \frac{4y}{x}.\]</span></p>
<p>Using the differential rules directly, the partial differentials turn out to be</p>
<p><span class="math display">\[
\partial_x z = \bigg(e^x \sin 5y + \frac{4y}{x^2}\bigg) \partial x, \quad
\partial_y z = \bigg(5e^x \cos 5y - \frac{4}{x}\bigg) \partial y.
\]</span></p>
<p>Dividing both sides by <span class="math inline">\(\partial x\)</span> and <span class="math inline">\(\partial y\)</span> respectively, the partial derivatives are then</p>
<p><span class="math display">\[
\frac{\partial z}{\partial x} = e^x \sin 5y + \frac{4y}{x^2}, \quad
\frac{\partial z}{\partial y} = 5e^x \cos 5y - \frac{4}{x}.
\]</span></p>
<p>We can calculate partial derivatives in sympy the same way we did ordinary derivatives. The only difference is we need to define two input symbols, and we need to be careful which one we differentiate the function with respect to. Here’s a sympy calculation of the partial derivatives from the previous example.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> sp.symbols(<span class="st">'x y'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> sp.exp(x) <span class="op">*</span> sp.sin(<span class="dv">5</span> <span class="op">*</span> y) <span class="op">-</span> <span class="dv">4</span> <span class="op">*</span> y <span class="op">/</span> x</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dzdx <span class="op">=</span> z.diff(x)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dzdy <span class="op">=</span> z.diff(y)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'z = </span><span class="sc">{</span>z<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'∂z/∂x = </span><span class="sc">{</span>dzdx<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'∂z/∂y = </span><span class="sc">{</span>dzdy<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>z = exp(x)*sin(5*y) - 4*y/x
∂z/∂x = exp(x)*sin(5*y) + 4*y/x**2
∂z/∂y = 5*exp(x)*cos(5*y) - 4/x</code></pre>
</div>
</div>
<p>We can calculate partial derivatives <em>numerically</em> just like we could ordinary derivatives. The exact same caveats apply. We’d want to choose <span class="math inline">\(\partial x\)</span> and <span class="math inline">\(\partial y\)</span> to be small, but not too small to avoid numerical roundoff. Below I’ll define two functions <code>diff_x(f, x, y, dx)</code> and <code>diff_y(f, x, y, dy)</code> to calculate the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> partials respectively.</p>
<p>As an example, I’ll numerically differentiate the function <span class="math inline">\(z=x^2+y^2\)</span> at the point <span class="math inline">\((1,1)\)</span>. In this case, both partial derivatives should be exactly <span class="math inline">\(2\)</span>. If <code>dx</code> and <code>dy</code> are both <code>1e-5</code>, the numerical estimate should agree with the exact answer to within an error of <code>1e-5</code>.</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> diff_x(f, x, y, dx<span class="op">=</span><span class="fl">1e-5</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    dz <span class="op">=</span> f(x <span class="op">+</span> dx, y) <span class="op">-</span> f(x, y)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dz <span class="op">/</span> dx</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> diff_y(f, x, y, dy<span class="op">=</span><span class="fl">1e-5</span>):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    dz <span class="op">=</span> f(x, y <span class="op">+</span> dy) <span class="op">-</span> f(x, y)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dz <span class="op">/</span> dy</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, y: x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'∂z/∂x = </span><span class="sc">{</span>diff_x(f, x, y)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'∂z/∂y = </span><span class="sc">{</span>diff_y(f, x, y)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>∂z/∂x = 2.00001000001393
∂z/∂y = 2.00001000001393</code></pre>
</div>
</div>
<p>As in the univariate case, a bivariate function needs to satisfy certain conditions in order to be differentiable. First, it needs to be <em>continuous</em>. We’d say a bivariate function <span class="math inline">\(z=f(x,y)\)</span> is <strong>continuous</strong> at a point <span class="math inline">\((a,b)\)</span> if, whenever <span class="math inline">\(x\)</span> is infinitesimally close to <span class="math inline">\(a\)</span> and <span class="math inline">\(y\)</span> is infinitesimally close to <span class="math inline">\(b\)</span>, the output <span class="math inline">\(z=f(x,y)\)</span> is infinitesimally close to <span class="math inline">\(f(a,b)\)</span>. Informally, this just says if <span class="math inline">\(x \approx a\)</span> and <span class="math inline">\(y \approx b\)</span>, then <span class="math inline">\(z \approx f(a,b)\)</span>. The function itself is called continuous if it’s continuous at <em>every</em> possible point <span class="math inline">\((a,b)\)</span> in the plane. This is just the bivariate way of saying the function’s graph can’t have any jumps or sudden breaks in it anywhere.</p>
<p>To be differentiable, the quotients forming both partial derivatives need to be well-defined. Graphically this just says the function’s graph also can’t any sharp kinks in it in either the <span class="math inline">\(x\)</span> direction or the <span class="math inline">\(y\)</span> direction.</p>
<p>As in the univariate case, just about all the bivariate functions we’re interested in are continuous and differentiable, including sums, powers, products, exponents, logarithms, trig functions, and quotients. Here are a few examples of continuous and differentiable bivariate functions:</p>
<ul>
<li><span class="math inline">\(z = x + y\)</span> for all <span class="math inline">\(x, y\)</span>.</li>
<li><span class="math inline">\(z = 10x - y^2\)</span> for all <span class="math inline">\(x, y\)</span>.</li>
<li><span class="math inline">\(z = e^{x - y}\)</span> for all <span class="math inline">\(x, y\)</span>.</li>
<li><span class="math inline">\(z = \log(10xy - 4) \sin x + \cos y\)</span> whenever <span class="math inline">\(10xy-4 &gt; 0\)</span>.</li>
<li><span class="math inline">\(z = \frac{10}{5x - y}\)</span> whenever <span class="math inline">\(5x-y \neq 0\)</span>.</li>
</ul>
</section>
<section id="total-differentials" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="total-differentials"><span class="header-section-number">7.1.2</span> Total Differentials</h3>
<p>The partial differentials only say how much the output changes in response to one variable changing. What if both variables are allowed to change? Suppose again we have a function <span class="math inline">\(z=f(x,y)\)</span>, but this time we change <em>both</em> <span class="math inline">\(x\)</span> by <span class="math inline">\(dx\)</span> <em>and</em> <span class="math inline">\(y\)</span> by <span class="math inline">\(dy\)</span>. The total amount <span class="math inline">\(z\)</span> would change evidently must be</p>
<p><span class="math display">\[dz = f(x+dx, y+dy) - f(x, y).\]</span></p>
<p>Since we’re allowing both inputs to vary now we can use the regular <span class="math inline">\(dz\)</span> notation for the differential. We’d call <span class="math inline">\(dz\)</span> the <strong>total differential</strong> of <span class="math inline">\(z\)</span>.</p>
<p>Let’s take a quick example. Take again the quadratic function <span class="math inline">\(z=x^2 + y^2\)</span>. If we follow the above rule, then we’d have</p>
<p><span class="math display">\[dz = f(x+dx, y+dy) - f(x, y) = \big((x + dx)^2 + (y + dy)^2\big) - \big(x^2 + y^2\big) = 2xdx + 2ydy + dx^2 + 2dxdy + dy^2.\]</span></p>
<p>If we assume <span class="math inline">\(dx\)</span> and <span class="math inline">\(dy\)</span> are both infinitesimal then we can neglect the quadratic terms, in which case we’d get</p>
<p><span class="math display">\[dz = 2xdx + 2ydy.\]</span></p>
<p>Notice something interesting. The term containing <span class="math inline">\(dx\)</span> is just the partial differential <span class="math inline">\(\partial_x z\)</span>, and the term containing <span class="math inline">\(dy\)</span> is just the partial differential <span class="math inline">\(\partial_y z\)</span>,</p>
<p><span class="math display">\[dz = \partial_x z + \partial_y z.\]</span></p>
<p>We can write the same thing in terms of the partial derivatives too,</p>
<p><span class="math display">\[dz = \frac{\partial z}{\partial x}dx + \frac{\partial z}{\partial y}dy.\]</span></p>
<p>It turns out this fact is true for any differentiable function <span class="math inline">\(z=f(x,y)\)</span>. To see why, notice that by adding and subtracting <span class="math inline">\(f(x+dx, y)\)</span> to <span class="math inline">\(dz\)</span>, we’d have</p>
<p><span class="math display">\[dz = f(x+dx, y+dy) - f(x, y) = \big(f(x+dx, y+dy) - f(x+dx, y) \big) + \big(f(x+dx, y) - f(x,y) \big).\]</span></p>
<p>We can think of this differential as a sum of two pieces. The second piece is just the partial differential <span class="math inline">\(\partial_x z\)</span> at the point <span class="math inline">\((x,y)\)</span>. The first piece is just the partial differential <span class="math inline">\(\partial_y z\)</span> at the point <span class="math inline">\((x+dx,y)\)</span>, but since <span class="math inline">\(dx\)</span> is infinitesimal this will be approximately the partial differential at <span class="math inline">\((x,y)\)</span> too. That is, we can always write the total differential <span class="math inline">\(dz\)</span> in the form</p>
<p><span class="math display">\[dz = \partial_x z + \partial_y z = \frac{\partial z}{\partial x}dx + \frac{\partial z}{\partial y}dy.\]</span></p>
<p>Evidently, we can think of an arbitrary small change in <span class="math inline">\(z\)</span> as being composed of two independent terms: One term that says how much <span class="math inline">\(z\)</span> will change in response to only <span class="math inline">\(x\)</span> varying, and another term that says how much <span class="math inline">\(z\)</span> will change in response to only <span class="math inline">\(y\)</span> varying. This is why I covered partial differentials first. We can build any total differential out of a sum of partial differentials. They’re in some sense a <em>basis</em> in the linear algebraic sense.</p>
</section>
<section id="tangent-planes" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="tangent-planes"><span class="header-section-number">7.1.3</span> Tangent Planes</h3>
<p>Let’s now try to get a visual understanding what these terms mean. Recall in the univariate case that we used the formula <span class="math inline">\(dy = \frac{dy}{dx} dx\)</span> to get a formula for the tangent line to the function <span class="math inline">\(y=f(x)\)</span> at the point <span class="math inline">\(x=a\)</span>,</p>
<p><span class="math display">\[f(x) \approx f(a) + \frac{d}{dx} f(a) \cdot (x-a).\]</span></p>
<p>The tangent line was the best approximation of the function <span class="math inline">\(y=f(x)\)</span> near the point <span class="math inline">\(x=a\)</span>, and the <em>slope</em> of the tangent line was just the derivative taken at the point <span class="math inline">\(a\)</span>. We can do a similar thing in the bivariate case.</p>
<p>Suppose we’re interested in approximating the function <span class="math inline">\(z=f(x,y)\)</span> around some point <span class="math inline">\((a,b)\)</span>. Provided <span class="math inline">\(x\)</span> is close to <span class="math inline">\(a\)</span> and <span class="math inline">\(y\)</span> is close to <span class="math inline">\(b\)</span>, we can use the total differential formula to write</p>
<p><span class="math display">\[f(x,y) \approx f(a,b) + \frac{\partial}{\partial x}f(a,b) \cdot (x-a) + \frac{\partial}{\partial x}f(a,b) \cdot (y-b).\]</span></p>
<p>Since the partial derivative terms <span class="math inline">\(\frac{\partial}{\partial x}f(a,b)\)</span> and <span class="math inline">\(\frac{\partial}{\partial y}f(a,b)\)</span> are just constants that depend only on <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, what we’re looking at is the formula for a <em>plane</em>. It’s called the <strong>tangent plane</strong>. The tangent plane is just the plane in 3D space that hugs the surface of <span class="math inline">\(z=f(x,y)\)</span> at the point <span class="math inline">\(\big(a,b,f(a,b)\big)\)</span>.</p>
<p>Recall for the quadratic function <span class="math inline">\(z=x^2 + y^2\)</span> had total differential <span class="math inline">\(dz = 2xdx + 2ydy\)</span>. Suppose we were interested in the tangent plane of the function at the point <span class="math inline">\((1,1)\)</span>. Since</p>
<p><span class="math display">\[f(1,1) = 1^2 + 1^2 = 2, \quad \frac{\partial}{\partial x}f(1,1) = 2 \cdot 1 = 2, \quad \frac{\partial}{\partial y}f(1,1) = 2 \cdot 1 = 2,\]</span></p>
<p>the tangent plane would just be given by</p>
<p><span class="math display">\[z = 2 + 2(x-1) + 2(y-1).\]</span></p>
<p>Here’s a 3D plot of the surface of <span class="math inline">\(z=x^2 + y^2\)</span> along with this tangent plane. Notice how the green plane is hugging tangent to the blue surface at a single point, namely the exact point <span class="math inline">\((1,1,2)\)</span>. The black curves shown on the blue surface correspond to the curves where <span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span> are constant, respectively. The black curves shown on the green surface correspond to the tangent lines of those same curves. The slope of those lines represents the value of that partial derivative at the point <span class="math inline">\((1, 1, 2)\)</span>.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, y: x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dfdx <span class="op">=</span> <span class="kw">lambda</span> x, y: (<span class="dv">2</span> <span class="op">*</span> x, <span class="dv">2</span> <span class="op">*</span> y)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> b <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">100</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">100</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>f_tangent <span class="op">=</span> <span class="kw">lambda</span> x, y: <span class="dv">2</span> <span class="op">*</span> a <span class="op">*</span> (x <span class="op">-</span> a) <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> b <span class="op">*</span> (y <span class="op">-</span> b) <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>plot_function_3d(x, y, [f, f_tangent], labelpad<span class="op">=</span><span class="dv">5</span>, ticks_every<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">4</span>], dist<span class="op">=</span><span class="dv">12</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                 xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), zlim<span class="op">=</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>), elev<span class="op">=</span><span class="dv">30</span>, azim<span class="op">=-</span><span class="dv">45</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                 points<span class="op">=</span>[(a, b, f(a, b))], colors<span class="op">=</span>[<span class="st">'blue'</span>, <span class="st">'green'</span>], alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                 curves <span class="op">=</span> [(x, <span class="dv">0</span> <span class="op">*</span> x <span class="op">+</span> b, f(x, b<span class="op">**</span><span class="dv">2</span>)), </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                           (<span class="dv">0</span> <span class="op">*</span> y <span class="op">+</span> a, y, f(a<span class="op">**</span><span class="dv">2</span>, y)),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                           (x, <span class="dv">0</span> <span class="op">*</span> x <span class="op">+</span> b, f_tangent(x, b<span class="op">**</span><span class="dv">2</span>)),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                           (<span class="dv">0</span> <span class="op">*</span> y <span class="op">+</span> a, y, f_tangent(a<span class="op">**</span><span class="dv">2</span>, y))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                          ],</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f'Tangent Plane to $z=x^2+y^2$ at $</span><span class="sc">{</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">$'</span>, titlepad<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multivariate-calculus_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As long as we’re near the point <span class="math inline">\((a,b)\)</span>, the function <span class="math inline">\(z=f(x,y)\)</span> is well approximated by its tangent plane. Said differently, we’ve managed to <strong>linearize</strong> the function near the point <span class="math inline">\((a,b)\)</span>. As long as <span class="math inline">\((x,y)\)</span> is close to <span class="math inline">\((a,b)\)</span>, we can for all practical purposes pretend the point is on the tangent plane. Anytime you see a plane or a line like this, you should immediately think linear algebra. Indeed, we’re on the cusp of seeing where calculus and linear algebra meet.</p>
</section>
<section id="gradients" class="level3" data-number="7.1.4">
<h3 data-number="7.1.4" class="anchored" data-anchor-id="gradients"><span class="header-section-number">7.1.4</span> Gradients</h3>
<p>So far we’ve talked about partial derivatives and total differentials, but we’ve yet to talk about a <em>total derivative</em>. Let’s look again at the formula for the total differential,</p>
<p><span class="math display">\[dz = \frac{\partial z}{\partial x}dx + \frac{\partial z}{\partial y}dy.\]</span></p>
<p>What would it even mean in this case to talk about a derivative as a ratio of total differentials? To make headway here we should step back and stare at this equation. If you look carefully, you’ll see this equation is screaming at us to use vector notation. It kind of looks like a dot product between two vectors.</p>
<p>If we define the following two vectors in the plane,</p>
<p><span class="math display">\[d\mathbf{x} = (dx, dy), \quad \mathbf{g} = \bigg(\frac{\partial z}{\partial x}, \frac{\partial z}{\partial y}\bigg),\]</span></p>
<p>then we can write the total differential as the dot product <span class="math inline">\(dz = \mathbf{g} \cdot d\mathbf{x}\)</span>. Notice the analogy between this equation and the one for the univariate differential <span class="math inline">\(dy = \frac{dy}{dx} dx\)</span>. Evidently, the vector <span class="math inline">\(\mathbf{g}\)</span> acts like some kind of vector derivative. It’s called the <strong>gradient vector</strong>, or usually just the <strong>gradient</strong>. By abusing notation a little bit, we’ll sometimes write the gradient as a ratio of differentials by pretending we can divide by <span class="math inline">\(d\mathbf{x}\)</span>,</p>
<p><span class="math display">\[\frac{dz}{d\mathbf{x}} = \mathbf{g} = \bigg(\frac{\partial z}{\partial x}, \frac{\partial z}{\partial y}\bigg),\]</span></p>
<p>Doing this makes it obvious that we can go back and forth between the total differential <span class="math inline">\(dz\)</span> and the gradient <span class="math inline">\(\mathbf{g}\)</span> by “multiplying” both sides by <span class="math inline">\(d\mathbf{x}\)</span>.</p>
<p>Another popular notation for the gradient is to use the <em>del</em> operator <span class="math inline">\(\nabla\)</span> to write the gradient as <span class="math inline">\(\nabla z\)</span> or <span class="math inline">\(\nabla f(\mathbf{x})\)</span>. I personally prefer to avoid this notation in most cases since, on top of introducing yet another strange symbol, <span class="math inline">\(\nabla z\)</span> doesn’t much help you remember what it is or what it does.</p>
<p>This new vector derivative suggests we should step back and think about multivariate calculus from the point of view of vectors instead of multiple variables. Instead of imagining a bivariate function as a function of the form <span class="math inline">\(z = f(x,y)\)</span>, let’s instead imagine it as a vector input function <span class="math inline">\(z = f(\mathbf{x})\)</span>, where <span class="math inline">\(\mathbf{x} = (x, y)\)</span> is a vector in the plane. It means exactly the same thing, except we’re now overloading the same function <span class="math inline">\(z=f(\cdot)\)</span> to map 2-dimensional <em>vector</em> inputs <span class="math inline">\(\mathbf{x}\)</span> to <em>scalar</em> outputs <span class="math inline">\(z\)</span>.</p>
<p>Let’s work a couple of examples. Take the quadratic function <span class="math inline">\(z = x^2 + y^2\)</span> again. We already showed its two partials are <span class="math inline">\(2x\)</span> and <span class="math inline">\(2y\)</span>. Putting these into a vector gives the gradient, <span class="math inline">\(\mathbf{g} = (2x, 2y)\)</span>. It’s interesting to think about this example in terms of vectors. Notice that this quadratic function is just the squared norm of <span class="math inline">\(\mathbf{x}\)</span>,</p>
<p><span class="math display">\[z = x^2 + y^2 = \mathbf{x} \cdot \mathbf{x} = ||\mathbf{x}||^2.\]</span></p>
<p>What we’ve evidently just shown is the gradient of the squared norm <span class="math inline">\(z = ||\mathbf{x}||^2\)</span> is <span class="math inline">\(\mathbf{g} = 2\mathbf{x}\)</span>. Notice how similar this looks to the scalar case, where the derivative of <span class="math inline">\(y=x^2\)</span> is <span class="math inline">\(\frac{dy}{dx} = 2x\)</span>.</p>
<p>Now let’s take the function <span class="math inline">\(z = ax + by\)</span>. This is easy. The gradient is just <span class="math inline">\(\mathbf{g} = (a, b)\)</span>. Again, what’s more interesting is thinking in terms of vectors. Let <span class="math inline">\(\mathbf{a} = (a,b)\)</span>. Then we can write <span class="math inline">\(z = \mathbf{a} \cdot \mathbf{x}\)</span>. What we’ve just shown then is the gradient of <span class="math inline">\(\mathbf{a} \cdot \mathbf{x}\)</span> is just <span class="math inline">\(\mathbf{a}\)</span>. Again, compare with the scalar case, where the derivative of <span class="math inline">\(y=ax\)</span> is just <span class="math inline">\(\frac{dy}{dx} = a\)</span>.</p>
<p>You can use sympy to compute gradients in a couple different ways. One way is just to calculate each of the partial derivatives one-by-one like I did before. Another way is to define a matrix symbol and take its derivative. Here’s an example of how to do this using the previous example.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sp.MatrixSymbol(<span class="st">'x'</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> sp.MatrixSymbol(<span class="st">'a'</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> a.T <span class="op">@</span> x</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>grad <span class="op">=</span> z.diff(x)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'z = </span><span class="sc">{</span>z<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'g = </span><span class="sc">{</span>grad<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>z = a.T*x
g = a</code></pre>
</div>
</div>
<p>To compute the gradient numerically, we just need to compute all the partial derivatives and put them into a vector. Since I already wrote two functions <code>diff_x</code> and <code>diff_y</code> to calculate the partial derivatives, all we need to do is call those two functions and put the outputs in a vector. I’ll create a function called <code>diff(f, x, y, dx, dy)</code> to do this. When we get more into vector notation I’ll clean it up a little so it generalizes to higher dimensions.</p>
<p>I’ll again use the example of <span class="math inline">\(z = x^2 + y^2\)</span> to calculate the gradient numerically at the point <span class="math inline">\((1,1)\)</span>. Again, nothing special here. We’re just putting the partial derivatives in a vector and returning it.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> diff(f, x, y, dx<span class="op">=</span><span class="fl">1e-5</span>, dy<span class="op">=</span><span class="fl">1e-5</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    dzdx <span class="op">=</span> diff_x(f, x, y, dx)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    dzdy <span class="op">=</span> diff_y(f, y, y, dy)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    grad <span class="op">=</span> [dzdx, dzdy]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grad</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, y: x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>grad <span class="op">=</span> diff(f, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'g = </span><span class="sc">{</span>grad<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>g = [2.00001000001393, 2.00001000001393]</code></pre>
</div>
</div>
<p>We can also write the tangent plane equation in vector notation. If <span class="math inline">\(\mathbf{a} = (a,b)\)</span> and <span class="math inline">\(\mathbf{x} \approx \mathbf{a}\)</span>, then the tangent plane of <span class="math inline">\(z=f(\mathbf{x})\)</span> at <span class="math inline">\(\mathbf{a}\)</span> is given by</p>
<p><span class="math display">\[f(\mathbf{x}) \approx f(\mathbf{a}) + \mathbf{g}(\mathbf{a})^\top (\mathbf{x} - \mathbf{a}).\]</span></p>
<p>The notation <span class="math inline">\(\mathbf{g}(\mathbf{a})\)</span> just means to take the gradient and evaluate it at <span class="math inline">\(\mathbf{x} = \mathbf{a}\)</span>. From this point of view we can think of the gradient as a <em>linear map</em> that maps vector differences <span class="math inline">\(d\mathbf{x} \approx (\mathbf{x} - \mathbf{a})\)</span> to scalar differences <span class="math inline">\(dz \approx f(\mathbf{x}) - f(\mathbf{a})\)</span>.</p>
<p>Now, consider again an arbitrary function <span class="math inline">\(z = f(\mathbf{x})\)</span>. Suppose we perturbed the input <span class="math inline">\(\mathbf{x}\)</span> in some arbitrary direction by an amount <span class="math inline">\(d\mathbf{x}\)</span>. This would have to change the output <span class="math inline">\(z\)</span> by an amount</p>
<p><span class="math display">\[dz = f(\mathbf{x} + d\mathbf{x}) - f(\mathbf{x}).\]</span></p>
<p>But I just showed this same change is given by the dot product of the gradient vector <span class="math inline">\(\mathbf{g}\)</span> with <span class="math inline">\(d\mathbf{x}\)</span>,</p>
<p><span class="math display">\[dz = \mathbf{g} \cdot d\mathbf{x}.\]</span></p>
<p>This suggests a way to define the gradient as a kind of ratio of differentials. Notice that by factoring out its norm we can write the differential vector <span class="math inline">\(d\mathbf{x}\)</span> as a scalar times a unit vector in the <span class="math inline">\(d\mathbf{x}\)</span> direction,</p>
<p><span class="math display">\[d\mathbf{x} = ||d\mathbf{x}|| \mathbf{e}_{dx}.\]</span></p>
<p>If we divide both sides of the total differential by the scalar norm <span class="math inline">\(||d\mathbf{x}||\)</span>, we evidently get</p>
<p><span class="math display">\[\mathbf{g} \cdot \mathbf{e}_{dx} = \frac{dz}{||d\mathbf{x}||} = \frac{f(\mathbf{x} + d\mathbf{x}) - f(\mathbf{x})}{||d\mathbf{x}||}.\]</span></p>
<p>Said differently, the <em>projection</em> of the gradient <span class="math inline">\(\mathbf{g}\)</span> in the direction of <span class="math inline">\(d\mathbf{x}\)</span> is just the ratio of the total differential over the norm of <span class="math inline">\(d\mathbf{x}\)</span>. This projection is sometimes called the <strong>directional derivative</strong> of <span class="math inline">\(z\)</span> in the direction of <span class="math inline">\(d\mathbf{x}\)</span>. The directional derivative is what we get if we ask, “What is the partial derivative of a function along an arbitrary line in the plane, not necessarily the x or y axes?” If <span class="math inline">\(\mathbf{e_u}\)</span> is any unit vector, the directional derivative in the <span class="math inline">\(u\)</span>-direction is just</p>
<p><span class="math display">\[\frac{\partial z}{\partial u} = \mathbf{g} \cdot \mathbf{e}_u.\]</span></p>
<p>The main reason I bring up the directional derivative is because it gives us a useful way to interpret the gradient graphically. Recall we can write the dot product of any two vectors in terms of the angle between them. If <span class="math inline">\(\theta\)</span> is the angle between the vectors <span class="math inline">\(\mathbf{g}\)</span> and <span class="math inline">\(\mathbf{e}_u\)</span>, we evidently have</p>
<p><span class="math display">\[\frac{\partial z}{\partial u} = ||\mathbf{g}|| \cdot ||\mathbf{e}_u|| \cos\theta = ||\mathbf{g}|| \cos\theta.\]</span></p>
<p>The right-hand side will be highest when <span class="math inline">\(\cos\theta = 1\)</span>, which occurs when <span class="math inline">\(\mathbf{g}\)</span> is parallel with <span class="math inline">\(\mathbf{e}_u\)</span>. This means the directional derivative will be highest when it’s pointing in the same direction as the gradient. Since derivatives are slopes, saying the directional derivative is highest in the direction of the gradient is the same thing as saying the slope of the curve is steepest in that direction. That is, the gradient points in the direction of <em>steepest ascent</em> of <span class="math inline">\(z=f(\mathbf{x})\)</span>, i.e.&nbsp;the direction that’s sloping up the fastest at a given point.</p>
<p>For example, take the quadratic <span class="math inline">\(z = x^2 + y^2\)</span> again. Its gradient is <span class="math inline">\(\mathbf{g} = (2x, 2y)\)</span>. Which way does this point? Well, since <span class="math inline">\(\mathbf{g} = 2\mathbf{x}\)</span>, it clearly points in the direction of <span class="math inline">\(\mathbf{x}\)</span>. That’s radially outward from the origin. If we look at the plot of this surface again, it’s clear that the function is increasing steepest as we move radially outward at any given point.</p>
<p>Here’s a plot of this function again, but showing the gradient at the point <span class="math inline">\((1,1)\)</span> as a red vector. Notice how the arrow is pointing radially outward from the point, or “up the bowl”.</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, y: x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dfdx <span class="op">=</span> <span class="kw">lambda</span> x, y: (<span class="dv">2</span> <span class="op">*</span> x, <span class="dv">2</span> <span class="op">*</span> y)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>a, b <span class="op">=</span> <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">100</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">100</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>f_tangent <span class="op">=</span> <span class="kw">lambda</span> x, y: <span class="dv">2</span> <span class="op">*</span> a <span class="op">*</span> (x <span class="op">-</span> a) <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> b <span class="op">*</span> (y <span class="op">-</span> b) <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>grad <span class="op">=</span> dfdx(a, b)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_tangent_plane(x, y, a, b, f, f_tangent, dfdx, plot_grad=True, grad_scale=2, title=f'')</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plot_function_3d(x, y, f, labelpad<span class="op">=</span><span class="dv">5</span>, ticks_every<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>], dist<span class="op">=</span><span class="dv">12</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                 xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), zlim<span class="op">=</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">20</span>), elev<span class="op">=</span><span class="dv">50</span>, azim<span class="op">=-</span><span class="dv">60</span>, titlepad<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                 points<span class="op">=</span>[(a, b, f(a, b))], title<span class="op">=</span><span class="ss">f'Gradient Vector at </span><span class="sc">{</span>(a, b)<span class="sc">}</span><span class="ss">'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># curves = [(x, 0 * x + b, f(x, b**2)), (0 * y + a, y, f(a**2, y))],</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                 arrows<span class="op">=</span>[[[a, b, f(a, b)], [grad[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">2</span>, grad[<span class="dv">1</span>] <span class="op">/</span> <span class="dv">2</span>, <span class="dv">0</span>]]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multivariate-calculus_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This may be easier to visualize if we look at the contour plot instead. Here’s the contour plot of the same surface, shown in blue. The tangent plane contours are shown in green. The gradient at <span class="math inline">\((1,1)\)</span> is the red vector. The interesting thing to notice here is that the gradient is pointing <em>perpendicular</em> to the contour lines of both the surface and the tangent plane.</p>
<p>If you think about the contour plot as a topographical map, following the gradient vector at each point would take you upward along the steepest possible path, probably <em>not</em> what you want if you’re a hiker, but it’s definitely what you want if you’re trying to get to the peak of a surface as quickly as possible.</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, y: x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dfdx <span class="op">=</span> <span class="kw">lambda</span> x, y: (<span class="dv">2</span> <span class="op">*</span> x, <span class="dv">2</span> <span class="op">*</span> y)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>a, b <span class="op">=</span> <span class="dv">1</span>, <span class="dv">1</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">100</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">100</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>f_tangent <span class="op">=</span> <span class="kw">lambda</span> x, y: <span class="dv">2</span> <span class="op">*</span> a <span class="op">*</span> (x <span class="op">-</span> a) <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> b <span class="op">*</span> (y <span class="op">-</span> b) <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>grad <span class="op">=</span> dfdx(a, b)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>levels <span class="op">=</span> [[<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">20</span>], [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>]]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [[<span class="st">'steelblue'</span>] <span class="op">*</span> <span class="bu">len</span>(levels), [<span class="st">'green'</span>]]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plot_contour(x, y, [f, f_tangent], points<span class="op">=</span>[(a, b)], arrows<span class="op">=</span>[[(a, b), (grad[<span class="dv">0</span>], grad[<span class="dv">1</span>])]], figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>             ticks_every<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">1</span>], show_clabels<span class="op">=</span><span class="va">True</span>, alphas<span class="op">=</span>[<span class="fl">0.6</span>, <span class="fl">0.9</span>], colors<span class="op">=</span>colors, levels<span class="op">=</span>levels,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>             title<span class="op">=</span><span class="ss">f'Gradient Vector at </span><span class="sc">{</span>(a, b)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multivariate-calculus_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Since the gradient can be thought of as a vector-valued function that maps vectors <span class="math inline">\(\mathbf{x}\)</span> to new vectors <span class="math inline">\(\mathbf{g}\)</span>, we can also think of the gradient as a vector field. Here’s a vector field plot of the gradient of <span class="math inline">\(z=x^2 + y^2\)</span> for different choices of <span class="math inline">\(\mathbf{x}\)</span>. Notice how all the gradients are pointing radially outwards. This follows from the fact that <span class="math inline">\(\mathbf{g} = 2\mathbf{x}\)</span> for this function. The arrows are also getting bigger the further we get away from the origin.</p>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_vector_field(dfdx, xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), ylim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>), n_points<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                      scale<span class="op">=</span><span class="va">None</span>, figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>), title<span class="op">=</span><span class="ss">f'Gradient as a Vector Field'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multivariate-calculus_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Notice something. Sense the gradient vectors all point up out of the bowl. The <em>negative</em> gradients must all point in the opposite direction, i.e.&nbsp;down into the bowl. If the positive gradient points in the direction of steepest <em>ascent</em>, then the negative gradient must point in the direction of steepest <em>descent</em>. Following the negative gradient takes you towards the bottom of the bowl as fast as possible. It’s hard to overstate how important this fact is to machine learning. The fundamental optimizer used to train most machine learning models is <em>gradient descent</em>. I’ll get back to this in a lot more detail in future lessons.</p>
</section>
<section id="hessians" class="level3" data-number="7.1.5">
<h3 data-number="7.1.5" class="anchored" data-anchor-id="hessians"><span class="header-section-number">7.1.5</span> Hessians</h3>
<p>In basic calculus we could also talk about derivatives of derivatives. The <em>second derivative</em> of a univariate function <span class="math inline">\(y=f(x)\)</span> is just the derivative of the derivative, i.e.</p>
<p><span class="math display">\[\frac{d^2 y}{dx^2} = \frac{d}{dx} \frac{dy}{dx}.\]</span></p>
<p>We can do the same thing in multivariate calculus, but we have to be careful about what we mean by <em>the</em> second derivative of a function.</p>
<p>Since partial derivatives are just univariate derivatives, we can take second partial derivatives in the usual way. The only difference is that we can now have <em>mixed partial derivatives</em>. If <span class="math inline">\(z=f(x,y)\)</span> is a bivariate function, it will have not <span class="math inline">\(2\)</span>, but <span class="math inline">\(2^2=4\)</span> second partial derivatives,</p>
<p><span class="math display">\[\frac{\partial^2 z}{\partial x^2}, \quad \frac{\partial^2 z}{\partial x \partial y}, \quad \frac{\partial^2 z}{\partial y \partial x}, \quad \frac{\partial^2 z}{\partial y^2}.\]</span></p>
<p>To work an example, let’s again look at the function</p>
<p><span class="math display">\[z = e^x \sin 5y - \frac{4y}{x}.\]</span></p>
<p>We already saw that the <em>first</em> partial derivatives are given by</p>
<p><span class="math display">\[
\frac{\partial z}{\partial x} = e^x \sin 5y + \frac{4y}{x^2}, \quad
\frac{\partial z}{\partial y} = 5e^x \cos 5y - \frac{4}{x}.
\]</span></p>
<p>We can get the <em>second</em> partial derivatives by differentiating both of these, each with respect to <em>both</em> <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>,</p>
<p><span class="math display">\[\begin{align*}
\frac{\partial^2 z}{\partial x^2} &amp;= \frac{\partial}{\partial x} \frac{\partial z}{\partial x} = e^x \sin 5y - \frac{8y}{x^3}, &amp;
\frac{\partial^2 z}{\partial x \partial y} &amp;= \frac{\partial}{\partial x} \frac{\partial z}{\partial y} = 5 e^x \cos 5y + \frac{4}{x^2}, \\
\frac{\partial^2 z}{\partial y \partial x} &amp;= \frac{\partial}{\partial y} \frac{\partial z}{\partial x} = 5e^x \cos 5y + \frac{4}{x^2}, &amp;
\frac{\partial^2 z}{\partial y^2} &amp;= \frac{\partial}{\partial y} \frac{\partial z}{\partial y} = -25e^x \sin 5y.
\end{align*}\]</span></p>
<p>Of course, sympy can calculate these for you. For example, to calculate the mixed partial <span class="math inline">\(\frac{\partial^2 z}{\partial y \partial x}\)</span>, just call <code>z.diff(x).diff(y)</code>. Notice how the ordering of the method call is backwards from the partial derivative notation. Be careful about that.</p>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> sp.symbols(<span class="st">'x y'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> sp.exp(x) <span class="op">*</span> sp.sin(<span class="dv">5</span> <span class="op">*</span> y) <span class="op">-</span> <span class="dv">4</span> <span class="op">*</span> y <span class="op">/</span> x</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'z = </span><span class="sc">{</span>z<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'∂∂z/∂x∂x = </span><span class="sc">{</span>z<span class="sc">.</span>diff(x)<span class="sc">.</span>diff(x)<span class="sc">}</span><span class="ss">, </span><span class="ch">\t</span><span class="ss"> ∂∂z/∂x∂y = </span><span class="sc">{</span>z<span class="sc">.</span>diff(y)<span class="sc">.</span>diff(x)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'∂∂z/∂y∂x = </span><span class="sc">{</span>z<span class="sc">.</span>diff(x)<span class="sc">.</span>diff(y)<span class="sc">}</span><span class="ss">, </span><span class="ch">\t</span><span class="ss"> ∂∂z/∂y∂y = </span><span class="sc">{</span>z<span class="sc">.</span>diff(y)<span class="sc">.</span>diff(y)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>z = exp(x)*sin(5*y) - 4*y/x
∂∂z/∂x∂x = exp(x)*sin(5*y) - 8*y/x**3,   ∂∂z/∂x∂y = 5*exp(x)*cos(5*y) + 4/x**2
∂∂z/∂y∂x = 5*exp(x)*cos(5*y) + 4/x**2,   ∂∂z/∂y∂y = -25*exp(x)*sin(5*y)</code></pre>
</div>
</div>
<p>I laid the second partials in this example out as a <span class="math inline">\(2 \times 2\)</span> grid on purpose to suggest that we should probably organize them into a <span class="math inline">\(2 \times 2\)</span> matrix. This matrix is called the <strong>Hessian matrix</strong>, or just the <strong>Hessian</strong> for short. I’ll denote it by the symbol <span class="math inline">\(\mathbf{H}\)</span>,</p>
<p><span class="math display">\[
\mathbf{H} =
\begin{pmatrix}
\frac{\partial^2 z}{\partial x^2} &amp; \frac{\partial^2 z}{\partial x \partial y} \\
\frac{\partial^2 z}{\partial y \partial x} &amp; \frac{\partial^2 z}{\partial y^2}
\end{pmatrix}.
\]</span></p>
<p>In the previous example the Hessian matrix turned out to be</p>
<p><span class="math display">\[
\mathbf{H} =
\begin{pmatrix}
e^x \sin 5y - \frac{8y}{x^3} &amp; 5 e^x \cos 5y + \frac{4}{x^2} \\
5 e^x \cos 5y + \frac{4}{x^2} &amp; -25e^x \sin 5y \\
\end{pmatrix}.
\]</span></p>
<p>If you stare at the off diagonals of this example, you’ll see this matrix is <em>symmetric</em>, i.e.&nbsp;<span class="math inline">\(\mathbf{H}^\top = \mathbf{H}\)</span>. This is a more or less general fact. As long as the second partial derivatives are all continuous, their Hessian matrix will be symmetric.</p>
<p>It may not be completely obvious, but the Hessian is indeed the multivariate generalization of the second derivative. I’ll show why in the next section. Because of this, I’ll sometimes denote the Hessian by pretending we can divide by <span class="math inline">\(d\mathbf{x}^2\)</span> and writing</p>
<p><span class="math display">\[\frac{d^2 z}{d\mathbf{x}^2} = \mathbf{H}.\]</span></p>
<p>Since we have the first and second derivatives now, we can talk about the <em>second-order</em> approximation of a function. If <span class="math inline">\(z = f(\mathbf{x})\)</span>, and <span class="math inline">\(\mathbf{x}\)</span> is close to some vector <span class="math inline">\(\mathbf{a}\)</span>, then the function’s best quadratic approximation is given by</p>
<p><span class="math display">\[f(\mathbf{x}) \approx f(\mathbf{a}) + \mathbf{g}(\mathbf{a})^\top (\mathbf{x} - \mathbf{a}) + \frac{1}{2}(\mathbf{x} - \mathbf{a})^\top \mathbf{H}(\mathbf{a}) (\mathbf{x} - \mathbf{a}).\]</span></p>
<p>Remember, <span class="math inline">\(\mathbf{g}(\mathbf{a})\)</span> and <span class="math inline">\(\mathbf{H}(\mathbf{a})\)</span> mean, take the gradient and Hessian and evaluate them at the point <span class="math inline">\(\mathbf{a}\)</span>. This means they’ll be arrays of numbers, not arrays of functions. Instead of a plane, this approximation will try to approximate the function near <span class="math inline">\(\mathbf{a}\)</span> with a quadratic surface. The interesting thing in the multivariate case is that a quadratic surface need not even be bowl-shaped. We can also have quadratic surfaces that look like a <strong>saddle</strong>, for example</p>
<p><span class="math display">\[z = x^2 - y^2.\]</span></p>
<div class="cell" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">100</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">100</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, y: x<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> y<span class="op">**</span><span class="dv">2</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plot_function_3d(x, y, f, title<span class="op">=</span><span class="st">'$z=x^2-y^2$'</span>, titlepad<span class="op">=</span><span class="dv">0</span>, labelpad<span class="op">=</span><span class="dv">5</span>, ticks_every<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>], dist<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                 figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>), elev<span class="op">=</span><span class="dv">30</span>, azim<span class="op">=</span><span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multivariate-calculus_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The presence of the quadratic form <span class="math inline">\((\mathbf{x} - \mathbf{a})^\top \mathbf{H}(\mathbf{a}) (\mathbf{x} - \mathbf{a})\)</span> should suggest what’s going on here. Recall that a quadratic form is closely related to the <em>eigenvalues</em> of a matrix. In particular, the <em>sign</em> of the eigenvalues say something about the sign of the quadratic form. In the scalar case, the <em>sign</em> of <span class="math inline">\(h\)</span> in an expression like <span class="math inline">\((x-a)h(x-a) = h(x-a)^2\)</span> says whether the quadratic will bowl upwards of downwards. In that case there were only two possibilities, up or down. In the <em>bivariate</em> case there are now three depending on the sign of the eigenvalues of <span class="math inline">\(\mathbf{H}(\mathbf{a})\)</span>:</p>
<ul>
<li>Both eigenvalues are positive: In this case, <span class="math inline">\(\mathbf{H}(\mathbf{a})\)</span> is positive definite. This means the quadratic surface will be an upward bowl shape. The prototypical example of this kind of quadratic is <span class="math inline">\(z = x^2 + y^2\)</span>.</li>
<li>Both eigenvalues are negative: In this case, <span class="math inline">\(\mathbf{H}(\mathbf{a})\)</span> is negative definite. This means the quadratic surface will be a downward bowl shape. The prototypical example of this kind of quadratic is <span class="math inline">\(z = -(x^2 + y^2)\)</span>.</li>
<li>One eigenvalue is positive, the other is negative: In this case, <span class="math inline">\(\mathbf{H}(\mathbf{a})\)</span> is neither, or indefinite. This means the quadratic surface will be a saddle shape. The prototypical examples of this kind of quadratic are <span class="math inline">\(z = x^2 - y^2\)</span> or <span class="math inline">\(z = -x^2 + y^2\)</span>.</li>
</ul>
<p>WORK EXAMPLE FOR QUADRATIC. MENTION SECOND ORDER APPROXIMATION FUNCTION. MAYBE USE THIS TO PLOT APPROXIMATING PARABOLOID FOR A SIMPLE NON-QUADRATIC FUNCTION. TO SHOW HESSIAN IS SECOND DERIVATIVE, NEED TO EITHER SHOW EACH ROW IS A GRADIENT OR OUTER PRODUCT, OR SHOW IT’S THE JACOBIAN OF THE GRADIENT IN THE NEXT SECTION.</p>
<p>Updates:</p>
<ul>
<li>Make it clear in the n-dimensional section that we’re looking at non-linear functions now. Show what they look like, and how we can linearize them and essentially recover a local linear algebra via <span class="math inline">\(dy = gdx\)</span>.</li>
<li>Add code to calculate the Hessian. Maybe demonstrate how slow it is for large <span class="math inline">\(n\)</span>.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-page-right">
  <div class="nav-page nav-page-previous">
      <a href="../notebooks/matrix-algebra.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Matrix Algebra</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notebooks/probability.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Basic Probability</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>